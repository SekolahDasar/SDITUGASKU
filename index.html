<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistem Dapodik Sekolah - Google Sheets Edition</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
        /* Tailwind CSS Classes - Inline untuk kompatibilitas */
        .min-h-full { min-height: 100%; }
        .h-full { height: 100%; }
        .w-full { width: 100%; }
        .max-w-md { max-width: 28rem; }
        .max-w-7xl { max-width: 80rem; }
        .max-w-2xl { max-width: 42rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .flex { display: flex; }
        .grid { display: grid; }
        .hidden { display: none; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .space-y-8 > * + * { margin-top: 2rem; }
        .space-y-6 > * + * { margin-top: 1.5rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-x-8 > * + * { margin-left: 2rem; }
        .space-x-4 > * + * { margin-left: 1rem; }
        .space-x-3 > * + * { margin-left: 0.75rem; }
        .space-x-2 > * + * { margin-left: 0.5rem; }
        .bg-gradient-to-br { background: linear-gradient(to bottom right, var(--tw-gradient-stops)); }
        .from-blue-600 { --tw-gradient-from: #2563eb; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(37, 99, 235, 0)); }
        .to-blue-800 { --tw-gradient-to: #1e40af; }
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-white { background-color: #ffffff; }
        .bg-blue-600 { background-color: #2563eb; }
        .bg-blue-500 { background-color: #3b82f6; }
        .bg-green-600 { background-color: #16a34a; }
        .bg-red-600 { background-color: #dc2626; }
        .bg-gray-500 { background-color: #6b7280; }
        .hover\:bg-blue-700:hover { background-color: #1d4ed8; }
        .hover\:bg-green-700:hover { background-color: #15803d; }
        .hover\:bg-red-700:hover { background-color: #b91c1c; }
        .hover\:bg-gray-600:hover { background-color: #4b5563; }
        .text-white { color: #ffffff; }
        .text-blue-600 { color: #2563eb; }
        .text-blue-100 { color: #dbeafe; }
        .text-gray-900 { color: #111827; }
        .text-gray-700 { color: #374151; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-500 { color: #6b7280; }
        .text-red-700 { color: #b91c1c; }
        .text-green-800 { color: #166534; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-md { border-radius: 0.375rem; }
        .rounded-full { border-radius: 9999px; }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .shadow { box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06); }
        .border { border-width: 1px; }
        .border-b { border-bottom-width: 1px; }
        .border-b-2 { border-bottom-width: 2px; }
        .border-gray-300 { border-color: #d1d5db; }
        .border-gray-200 { border-color: #e5e7eb; }
        .border-blue-500 { border-color: #3b82f6; }
        .border-transparent { border-color: transparent; }
        .p-8 { padding: 2rem; }
        .p-6 { padding: 1.5rem; }
        .p-5 { padding: 1.25rem; }
        .p-4 { padding: 1rem; }
        .p-3 { padding: 0.75rem; }
        .p-2 { padding: 0.5rem; }
        .px-8 { padding-left: 2rem; padding-right: 2rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-1 { padding-left: 0.25rem; padding-right: 0.25rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
        .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .mt-8 { margin-top: 2rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-3 { margin-top: 0.75rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mr-3 { margin-right: 0.75rem; }
        .mr-2 { margin-right: 0.5rem; }
        .ml-3 { margin-left: 0.75rem; }
        .ml-2 { margin-left: 0.5rem; }
        .ml-5 { margin-left: 1.25rem; }
        .ml-auto { margin-left: auto; }
        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .text-xs { font-size: 0.75rem; line-height: 1rem; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .font-bold { font-weight: 700; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .uppercase { text-transform: uppercase; }
        .tracking-wider { letter-spacing: 0.05em; }
        .focus\:outline-none:focus { outline: 2px solid transparent; outline-offset: 2px; }
        .focus\:ring-2:focus { box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5); }
        .focus\:ring-blue-500:focus { box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5); }
        .focus\:border-blue-500:focus { border-color: #3b82f6; }
        .transition { transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .duration-200 { transition-duration: 200ms; }
        .cursor-pointer { cursor: pointer; }
        .resize-none { resize: none; }
        .overflow-hidden { overflow: hidden; }
        .overflow-x-auto { overflow-x: auto; }
        .overflow-y-auto { overflow-y: auto; }
        .whitespace-nowrap { white-space: nowrap; }
        .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .divide-y > * + * { border-top-width: 1px; }
        .divide-gray-200 > * + * { border-top-color: #e5e7eb; }
        .min-w-full { min-width: 100%; }
        .w-96 { width: 24rem; }
        .w-24 { width: 6rem; }
        .w-20 { width: 5rem; }
        .w-12 { width: 3rem; }
        .w-10 { width: 2.5rem; }
        .w-8 { width: 2rem; }
        .w-6 { width: 1.5rem; }
        .w-5 { width: 1.25rem; }
        .w-4 { width: 1rem; }
        .w-0 { width: 0px; }
        .h-24 { height: 6rem; }
        .h-20 { height: 5rem; }
        .h-12 { height: 3rem; }
        .h-10 { height: 2.5rem; }
        .h-8 { height: 2rem; }
        .h-6 { height: 1.5rem; }
        .h-5 { height: 1.25rem; }
        .h-4 { height: 1rem; }
        .h-20 { height: 5rem; }
        .flex-1 { flex: 1 1 0%; }
        .flex-shrink-0 { flex-shrink: 0; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        .gap-6 { gap: 1.5rem; }
        .gap-4 { gap: 1rem; }
        .gap-2 { gap: 0.5rem; }
        .col-span-3 { grid-column: span 3 / span 3; }
        .inline-flex { display: inline-flex; }
        .inline { display: inline; }
        .block { display: block; }
        .fixed { position: fixed; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .inset-0 { top: 0px; right: 0px; bottom: 0px; left: 0px; }
        .top-20 { top: 5rem; }
        .top-10 { top: 2.5rem; }
        .top-4 { top: 1rem; }
        .right-4 { right: 1rem; }
        .z-50 { z-index: 50; }
        .object-cover { object-fit: cover; }
        .bg-opacity-50 { --tw-bg-opacity: 0.5; }
        .bg-opacity-30 { --tw-bg-opacity: 0.3; }
        .disabled\:opacity-50:disabled { opacity: 0.5; }
        .disabled\:cursor-not-allowed:disabled { cursor: not-allowed; }
        .hover\:text-gray-700:hover { color: #374151; }
        .hover\:border-gray-300:hover { border-color: #d1d5db; }
        .hover\:text-blue-900:hover { color: #1e3a8a; }
        .hover\:text-red-900:hover { color: #7f1d1d; }
        .hover\:bg-gray-50:hover { background-color: #f9fafb; }
        .hover\:bg-blue-50:hover { background-color: #eff6ff; }
        .hover\:border-blue-500:hover { border-color: #3b82f6; }
        .hover\:border-gray-400:hover { border-color: #9ca3af; }
        .hover\:text-blue-500:hover { color: #3b82f6; }
        .hover\:text-green-700:hover { color: #15803d; }
        .last\:border-b-0:last-child { border-bottom-width: 0px; }
        .bg-red-50 { background-color: #fef2f2; }
        .bg-green-50 { background-color: #f0fdf4; }
        .bg-yellow-50 { background-color: #fefce8; }
        .bg-blue-50 { background-color: #eff6ff; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-green-100 { background-color: #dcfce7; }
        .bg-red-100 { background-color: #fee2e2; }
        .bg-blue-100 { background-color: #dbeafe; }
        .bg-orange-100 { background-color: #fed7aa; }
        .bg-purple-100 { background-color: #e9d5ff; }
        .bg-yellow-100 { background-color: #fef3c7; }
        .border-red-200 { border-color: #fecaca; }
        .border-green-200 { border-color: #bbf7d0; }
        .border-yellow-200 { border-color: #fde68a; }
        .border-dashed { border-style: dashed; }
        .border-2 { border-width: 2px; }
        .text-red-600 { color: #dc2626; }
        .text-green-600 { color: #16a34a; }
        .text-orange-600 { color: #ea580c; }
        .text-purple-600 { color: #9333ea; }
        .text-yellow-400 { color: #facc15; }
        .text-yellow-800 { color: #92400e; }
        .text-yellow-700 { color: #a16207; }
        .text-green-700 { color: #15803d; }
        .text-blue-700 { color: #1d4ed8; }
        .text-red-900 { color: #7f1d1d; }
        .text-gray-400 { color: #9ca3af; }
        .from-green-500 { --tw-gradient-from: #22c55e; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(34, 197, 94, 0)); }
        .to-green-600 { --tw-gradient-to: #16a34a; }
        .from-orange-500 { --tw-gradient-from: #f97316; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(249, 115, 22, 0)); }
        .to-orange-600 { --tw-gradient-to: #ea580c; }
        .from-purple-500 { --tw-gradient-from: #a855f7; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(168, 85, 247, 0)); }
        .to-purple-600 { --tw-gradient-to: #9333ea; }
        .from-blue-500 { --tw-gradient-from: #3b82f6; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(59, 130, 246, 0)); }
        .bg-blue-400 { background-color: #60a5fa; }
        .bg-green-400 { background-color: #4ade80; }
        .bg-orange-400 { background-color: #fb923c; }
        .bg-purple-400 { background-color: #c084fc; }
        .pt-4 { padding-top: 1rem; }
        .border-t { border-top-width: 1px; }
        .max-h-64 { max-height: 16rem; }

        /* Media Queries untuk Responsif */
        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
            .md\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        }
        
        @media (min-width: 1024px) {
            .lg\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .lg\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
            .lg\:px-8 { padding-left: 2rem; padding-right: 2rem; }
        }

        @media (min-width: 640px) {
            .sm\:px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        }
    </style>
  <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading-spinner {
            border: 2px solid #f3f4f6;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-connected {
            background-color: #10b981;
            color: white;
        }
        .status-disconnected {
            background-color: #ef4444;
            color: white;
        }
        .status-connecting {
            background-color: #f59e0b;
            color: white;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gray-50"><!-- Connection Status Indicator -->
  <div id="connection-status" class="connection-status status-disconnected">
   🔴 Tidak Terhubung ke Google Sheets
  </div><!-- Login Page -->
  <div id="login-page" class="min-h-full bg-gradient-to-br from-blue-600 to-blue-800 flex items-center justify-center px-4">
   <div class="max-w-md w-full space-y-8">
    <div class="text-center">
     <div class="mx-auto h-20 w-20 bg-white rounded-full flex items-center justify-center mb-4">
      <svg class="w-12 h-12 text-blue-600" fill="currentColor" viewbox="0 0 20 20"><path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z" />
      </svg>
     </div>
     <h2 class="text-3xl font-bold text-white">Sistem Dapodik</h2>
     <p class="mt-2 text-blue-100">Google Sheets Edition - Silakan login untuk mengakses sistem</p>
    </div>
    <div class="bg-white rounded-lg shadow-xl p-8">
     <form onsubmit="handleLogin(event)" class="space-y-6">
      <div id="login-error" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md text-sm">
       Username atau password salah!
      </div>
      <div><label for="username" class="block text-sm font-medium text-gray-700 mb-2">Username</label> <input type="text" id="username" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Masukkan username">
      </div>
      <div><label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label> <input type="password" id="password" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Masukkan password">
      </div><button type="submit" id="login-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200 flex items-center justify-center"> <span class="login-text">Masuk</span>
       <div class="loading-spinner ml-2 hidden"></div></button>
     </form>
     <div class="mt-6 p-4 bg-gray-50 rounded-md">
      <p class="text-sm text-gray-600 font-medium mb-2">Demo Login:</p>
      <p class="text-xs text-gray-500">Username: <span class="font-mono bg-gray-200 px-1 rounded">admin</span></p>
      <p class="text-xs text-gray-500">Password: <span class="font-mono bg-gray-200 px-1 rounded">admin123</span></p>
     </div>
    </div>
   </div>
  </div><!-- Main Application -->
  <div id="main-app" class="min-h-full hidden"><!-- Header -->
   <header class="bg-blue-600 shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
     <div class="flex justify-between items-center py-4">
      <div class="flex items-center">
       <div class="bg-white p-2 rounded-lg mr-3">
        <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewbox="0 0 20 20"><path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z" />
        </svg>
       </div>
       <div>
        <h1 id="nama-sekolah" class="text-xl font-bold text-white">SDN Merdeka 01</h1>
        <p id="alamat-sekolah" class="text-blue-100 text-sm">Jl. Pendidikan No. 123, Jakarta</p>
       </div>
      </div>
      <div class="flex items-center space-x-4">
       <div class="text-right">
        <p class="text-white font-medium">Kepala Sekolah</p>
        <p id="kepala-sekolah" class="text-blue-100 text-sm">Drs. Ahmad Wijaya, M.Pd</p>
       </div><button onclick="handleLogout()" class="bg-blue-500 hover:bg-blue-400 text-white px-3 py-1 rounded-md text-sm font-medium transition duration-200"> Logout </button>
      </div>
     </div>
    </div>
   </header><!-- Navigation -->
   <nav class="bg-white shadow-sm border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
     <div class="flex space-x-8"><button onclick="showTab('beranda')" id="tab-beranda" class="py-4 px-1 border-b-2 border-blue-500 font-medium text-sm text-blue-600"> Beranda </button> <button onclick="showTab('siswa')" id="tab-siswa" class="py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300"> Data Siswa </button> <button onclick="showTab('guru')" id="tab-guru" class="py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300"> Data Guru </button> <button onclick="showTab('tendik')" id="tab-tendik" class="py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300"> Data Tendik </button> <button onclick="showTab('kelas')" id="tab-kelas" class="py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300"> Data Kelas </button> <button onclick="showTab('pengaturan')" id="tab-pengaturan" class="py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300"> Pengaturan </button>
     </div>
    </div>
   </nav><!-- Main Content -->
   <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8"><!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
     <div class="bg-white overflow-hidden shadow rounded-lg">
      <div class="p-5">
       <div class="flex items-center">
        <div class="flex-shrink-0">
         <svg class="h-6 w-6 text-blue-600" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z" />
         </svg>
        </div>
        <div class="ml-5 w-0 flex-1">
         <dl>
          <dt class="text-sm font-medium text-gray-500 truncate">
           Total Siswa
          </dt>
          <dd id="total-siswa" class="text-lg font-medium text-gray-900">
           0
          </dd>
         </dl>
        </div>
       </div>
      </div>
     </div>
     <div class="bg-white overflow-hidden shadow rounded-lg">
      <div class="p-5">
       <div class="flex items-center">
        <div class="flex-shrink-0">
         <svg class="h-6 w-6 text-green-600" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
         </svg>
        </div>
        <div class="ml-5 w-0 flex-1">
         <dl>
          <dt class="text-sm font-medium text-gray-500 truncate">
           Total Guru
          </dt>
          <dd id="total-guru" class="text-lg font-medium text-gray-900">
           0
          </dd>
         </dl>
        </div>
       </div>
      </div>
     </div>
     <div class="bg-white overflow-hidden shadow rounded-lg">
      <div class="p-5">
       <div class="flex items-center">
        <div class="flex-shrink-0">
         <svg class="h-6 w-6 text-orange-600" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V6a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V8a2 2 0 012-2V6z" />
         </svg>
        </div>
        <div class="ml-5 w-0 flex-1">
         <dl>
          <dt class="text-sm font-medium text-gray-500 truncate">
           Total Tendik
          </dt>
          <dd id="total-tendik" class="text-lg font-medium text-gray-900">
           0
          </dd>
         </dl>
        </div>
       </div>
      </div>
     </div>
     <div class="bg-white overflow-hidden shadow rounded-lg">
      <div class="p-5">
       <div class="flex items-center">
        <div class="flex-shrink-0">
         <svg class="h-6 w-6 text-purple-600" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
         </svg>
        </div>
        <div class="ml-5 w-0 flex-1">
         <dl>
          <dt class="text-sm font-medium text-gray-500 truncate">
           Total Kelas
          </dt>
          <dd id="total-kelas" class="text-lg font-medium text-gray-900">
           0
          </dd>
         </dl>
        </div>
       </div>
      </div>
     </div>
    </div><!-- Content Sections -->
    <div class="bg-white shadow rounded-lg"><!-- Beranda Section -->
     <div id="section-beranda" class="fade-in">
      <div class="px-6 py-4 border-b border-gray-200">
       <h2 class="text-lg font-medium text-gray-900">Dashboard Rekap Data</h2>
       <p class="text-sm text-gray-600 mt-1">Data tersimpan di Google Sheets secara real-time</p>
      </div>
      <div class="p-6"><!-- Google Sheets Connection Status -->
       <div id="sheets-status" class="mb-6 p-4 rounded-lg border">
        <div class="flex items-center">
         <div id="sheets-status-icon" class="mr-3">
          <svg class="w-5 h-5 text-red-500" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
          </svg>
         </div>
         <div>
          <h3 id="sheets-status-title" class="text-sm font-medium text-red-800">Google Sheets Tidak Terhubung</h3>
          <p id="sheets-status-desc" class="text-sm text-red-600">Silakan konfigurasi API Key dan Sheet ID di menu Pengaturan</p>
         </div>
        </div>
       </div><!-- Summary Cards -->
       <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-6 text-white">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-blue-100 text-sm">Siswa Aktif</p>
           <p id="dashboard-siswa" class="text-2xl font-bold">0</p>
          </div>
          <div class="bg-blue-400 bg-opacity-30 rounded-full p-3">
           <svg class="w-6 h-6" fill="currentColor" viewbox="0 0 20 20"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
           </svg>
          </div>
         </div>
        </div>
        <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-6 text-white">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-green-100 text-sm">Guru Aktif</p>
           <p id="dashboard-guru" class="text-2xl font-bold">0</p>
          </div>
          <div class="bg-green-400 bg-opacity-30 rounded-full p-3">
           <svg class="w-6 h-6" fill="currentColor" viewbox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" />
           </svg>
          </div>
         </div>
        </div>
        <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg p-6 text-white">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-orange-100 text-sm">Tendik Aktif</p>
           <p id="dashboard-tendik" class="text-2xl font-bold">0</p>
          </div>
          <div class="bg-orange-400 bg-opacity-30 rounded-full p-3">
           <svg class="w-6 h-6" fill="currentColor" viewbox="0 0 20 20"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z" />
           </svg>
          </div>
         </div>
        </div>
        <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg p-6 text-white">
         <div class="flex items-center justify-between">
          <div>
           <p class="text-purple-100 text-sm">Total Kelas</p>
           <p id="dashboard-kelas" class="text-2xl font-bold">0</p>
          </div>
          <div class="bg-purple-400 bg-opacity-30 rounded-full p-3">
           <svg class="w-6 h-6" fill="currentColor" viewbox="0 0 20 20"><path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3z" />
           </svg>
          </div>
         </div>
        </div>
       </div><!-- Recent Activity -->
       <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-gray-50 rounded-lg p-6">
         <h3 class="text-lg font-medium text-gray-900 mb-4">Data Terbaru</h3>
         <div id="recent-activity" class="space-y-3">
          <p class="text-gray-500 text-sm">Belum ada aktivitas terbaru</p>
         </div>
        </div>
        <div class="bg-gray-50 rounded-lg p-6">
         <h3 class="text-lg font-medium text-gray-900 mb-4">Ringkasan Sistem</h3>
         <div class="space-y-3">
          <div class="flex justify-between items-center"><span class="text-sm text-gray-600">Total Data Tersimpan</span> <span id="total-records" class="font-medium">0</span>
          </div>
          <div class="flex justify-between items-center"><span class="text-sm text-gray-600">Status Google Sheets</span> <span id="sheets-connection-status" class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800"> Tidak Terhubung </span>
          </div>
          <div class="flex justify-between items-center"><span class="text-sm text-gray-600">Terakhir Sync</span> <span id="last-sync" class="text-sm text-gray-500">-</span>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Data Siswa Section -->
     <div id="section-siswa" class="hidden">
      <div class="px-6 py-4 border-b border-gray-200">
       <div class="flex justify-between items-center">
        <h2 class="text-lg font-medium text-gray-900">Data Siswa</h2>
        <div class="flex space-x-2"><button onclick="syncWithGoogleSheets()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg> Sync Google Sheets </button> <button onclick="downloadExcel('siswa')" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg> Download Excel </button> <button onclick="showImportModal('siswa')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
          </svg> Import Excel/CSV </button> <button onclick="showAddForm('siswa')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium"> + Tambah Siswa </button>
        </div>
       </div>
      </div><!-- Add Form Siswa -->
      <div id="form-siswa" class="hidden px-6 py-4 bg-gray-50 border-b">
       <form onsubmit="addData(event, 'siswa')" class="grid grid-cols-1 md:grid-cols-3 gap-4"><input type="text" id="nama-siswa" placeholder="Nama Lengkap" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="text" id="nama-panggilan-siswa" placeholder="Nama Panggilan" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="text" id="nis-siswa" placeholder="NIS" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="text" id="nisn-siswa" placeholder="NISN" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <select id="jk-siswa" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <option value="">Pilih Jenis Kelamin</option> <option value="Laki-laki">Laki-laki</option> <option value="Perempuan">Perempuan</option> </select> <select id="agama-siswa" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <option value="">Pilih Agama</option> <option value="Islam">Islam</option> <option value="Kristen">Kristen</option> <option value="Katolik">Katolik</option> <option value="Hindu">Hindu</option> <option value="Buddha">Buddha</option> <option value="Konghucu">Konghucu</option> </select> <input type="text" id="tempat-lahir-siswa" placeholder="Tempat Lahir" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="date" id="tanggal-lahir-siswa" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <select id="kelas-siswa" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <option value="">Pilih Kelas</option> <option value="1A">1A</option> <option value="1B">1B</option> <option value="2A">2A</option> <option value="2B">2B</option> <option value="3A">3A</option> <option value="3B">3B</option> <option value="4A">4A</option> <option value="4B">4B</option> <option value="5A">5A</option> <option value="5B">5B</option> <option value="6A">6A</option> <option value="6B">6B</option> </select> <textarea id="alamat-siswa" placeholder="Alamat Lengkap" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 col-span-3 h-20 resize-none"></textarea> <input type="text" id="nama-ayah-siswa" placeholder="Nama Ayah" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="text" id="nama-ibu-siswa" placeholder="Nama Ibu" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <div class="flex space-x-2 col-span-3"><button type="submit" id="submit-siswa" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center"> <span class="submit-text">Simpan</span>
          <div class="loading-spinner ml-2 hidden"></div></button> <button type="button" onclick="hideAddForm('siswa')" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md text-sm font-medium"> Batal </button>
        </div>
       </form>
      </div><!-- Table Siswa -->
      <div class="overflow-x-auto">
       <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
         <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NIS</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NISN</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">JK</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kelas</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Orang Tua</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
         </tr>
        </thead>
        <tbody id="table-siswa" class="bg-white divide-y divide-gray-200">
         <tr>
          <td colspan="9" class="px-6 py-8 text-center text-gray-500">Belum ada data siswa. Klik "Tambah Siswa" untuk menambah data.</td>
         </tr>
        </tbody>
       </table>
      </div>
     </div><!-- Data Guru Section -->
     <div id="section-guru" class="hidden">
      <div class="px-6 py-4 border-b border-gray-200">
       <div class="flex justify-between items-center">
        <h2 class="text-lg font-medium text-gray-900">Data Guru</h2>
        <div class="flex space-x-2"><button onclick="syncWithGoogleSheets()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg> Sync Google Sheets </button> <button onclick="downloadExcel('guru')" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg> Download Excel </button> <button onclick="showImportModal('guru')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
          </svg> Import Excel/CSV </button> <button onclick="showAddForm('guru')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium"> + Tambah Guru </button>
        </div>
       </div>
      </div><!-- Add Form Guru -->
      <div id="form-guru" class="hidden px-6 py-4 bg-gray-50 border-b">
       <form onsubmit="addData(event, 'guru')" class="grid grid-cols-1 md:grid-cols-3 gap-4"><input type="text" id="nama-guru" placeholder="Nama Lengkap" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="text" id="nik-guru" placeholder="NIK" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="text" id="nuptk-guru" placeholder="NUPTK" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="text" id="tempat-lahir-guru" placeholder="Tempat Lahir" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="date" id="tanggal-lahir-guru" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="tel" id="no-telepon-guru" placeholder="No. Telepon (WA)" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="email" id="email-guru" placeholder="Email" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <select id="jabatan-guru" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <option value="">Pilih Jabatan</option> <option value="Guru Kelas">Guru Kelas</option> <option value="Guru Mata Pelajaran">Guru Mata Pelajaran</option> <option value="Guru Olahraga">Guru Olahraga</option> <option value="Guru Agama">Guru Agama</option> <option value="Guru Bahasa Inggris">Guru Bahasa Inggris</option> <option value="Kepala Sekolah">Kepala Sekolah</option> <option value="Wakil Kepala Sekolah">Wakil Kepala Sekolah</option> </select> <textarea id="alamat-guru" placeholder="Alamat Lengkap" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 col-span-3 h-20 resize-none"></textarea>
        <div class="flex space-x-2 col-span-3"><button type="submit" id="submit-guru" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center"> <span class="submit-text">Simpan</span>
          <div class="loading-spinner ml-2 hidden"></div></button> <button type="button" onclick="hideAddForm('guru')" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md text-sm font-medium"> Batal </button>
        </div>
       </form>
      </div><!-- Table Guru -->
      <div class="overflow-x-auto">
       <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
         <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NIK</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NUPTK</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jabatan</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No. Telepon</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
         </tr>
        </thead>
        <tbody id="table-guru" class="bg-white divide-y divide-gray-200">
         <tr>
          <td colspan="8" class="px-6 py-8 text-center text-gray-500">Belum ada data guru. Klik "Tambah Guru" untuk menambah data.</td>
         </tr>
        </tbody>
       </table>
      </div>
     </div><!-- Data Tendik Section -->
     <div id="section-tendik" class="hidden">
      <div class="px-6 py-4 border-b border-gray-200">
       <div class="flex justify-between items-center">
        <h2 class="text-lg font-medium text-gray-900">Data Tenaga Kependidikan</h2>
        <div class="flex space-x-2"><button onclick="syncWithGoogleSheets()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg> Sync Google Sheets </button> <button onclick="downloadExcel('tendik')" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg> Download Excel </button> <button onclick="showImportModal('tendik')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
          </svg> Import Excel/CSV </button> <button onclick="showAddForm('tendik')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium"> + Tambah Tendik </button>
        </div>
       </div>
      </div><!-- Add Form Tendik -->
      <div id="form-tendik" class="hidden px-6 py-4 bg-gray-50 border-b">
       <form onsubmit="addData(event, 'tendik')" class="grid grid-cols-1 md:grid-cols-3 gap-4"><input type="text" id="nama-tendik" placeholder="Nama Lengkap" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="text" id="nik-tendik" placeholder="NIK" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="text" id="nuptk-tendik" placeholder="NUPTK" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="text" id="tempat-lahir-tendik" placeholder="Tempat Lahir" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="date" id="tanggal-lahir-tendik" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="tel" id="no-telepon-tendik" placeholder="No. Telepon (WA)" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="email" id="email-tendik" placeholder="Email" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <select id="jabatan-tendik" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <option value="">Pilih Jabatan</option> <option value="Tata Usaha">Tata Usaha</option> <option value="Pustakawan">Pustakawan</option> <option value="Laboran">Laboran</option> <option value="Teknisi">Teknisi</option> <option value="Penjaga Sekolah">Penjaga Sekolah</option> <option value="Cleaning Service">Cleaning Service</option> <option value="Satpam">Satpam</option> <option value="Operator Sekolah">Operator Sekolah</option> </select> <textarea id="alamat-tendik" placeholder="Alamat Lengkap" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 col-span-3 h-20 resize-none"></textarea>
        <div class="flex space-x-2 col-span-3"><button type="submit" id="submit-tendik" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center"> <span class="submit-text">Simpan</span>
          <div class="loading-spinner ml-2 hidden"></div></button> <button type="button" onclick="hideAddForm('tendik')" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md text-sm font-medium"> Batal </button>
        </div>
       </form>
      </div><!-- Table Tendik -->
      <div class="overflow-x-auto">
       <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
         <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NIK</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NUPTK</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jabatan</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No. Telepon</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
         </tr>
        </thead>
        <tbody id="table-tendik" class="bg-white divide-y divide-gray-200">
         <tr>
          <td colspan="8" class="px-6 py-8 text-center text-gray-500">Belum ada data tendik. Klik "Tambah Tendik" untuk menambah data.</td>
         </tr>
        </tbody>
       </table>
      </div>
     </div><!-- Data Kelas Section -->
     <div id="section-kelas" class="hidden">
      <div class="px-6 py-4 border-b border-gray-200">
       <div class="flex justify-between items-center">
        <h2 class="text-lg font-medium text-gray-900">Data Kelas</h2>
        <div class="flex space-x-2"><button onclick="syncWithGoogleSheets()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg> Sync Google Sheets </button> <button onclick="downloadExcel('kelas')" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg> Download Excel </button> <button onclick="showImportModal('kelas')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
          </svg> Import Excel/CSV </button> <button onclick="showAddForm('kelas')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium"> + Tambah Kelas </button>
        </div>
       </div>
      </div><!-- Add Form Kelas -->
      <div id="form-kelas" class="hidden px-6 py-4 bg-gray-50 border-b">
       <form onsubmit="addData(event, 'kelas')" class="grid grid-cols-1 md:grid-cols-4 gap-4"><input type="text" id="nama-kelas" placeholder="Nama Kelas (contoh: 1A)" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="text" id="wali-kelas" placeholder="Wali Kelas" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <select id="tingkat-kelas" required class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"> <option value="">Pilih Tingkat</option> <option value="Kelas 1">Kelas 1</option> <option value="Kelas 2">Kelas 2</option> <option value="Kelas 3">Kelas 3</option> <option value="Kelas 4">Kelas 4</option> <option value="Kelas 5">Kelas 5</option> <option value="Kelas 6">Kelas 6</option> </select>
        <div class="flex space-x-2"><button type="submit" id="submit-kelas" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center"> <span class="submit-text">Simpan</span>
          <div class="loading-spinner ml-2 hidden"></div></button> <button type="button" onclick="hideAddForm('kelas')" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md text-sm font-medium"> Batal </button>
        </div>
       </form>
      </div><!-- Table Kelas -->
      <div class="overflow-x-auto">
       <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
         <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Kelas</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Wali Kelas</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tingkat</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
         </tr>
        </thead>
        <tbody id="table-kelas" class="bg-white divide-y divide-gray-200">
         <tr>
          <td colspan="6" class="px-6 py-8 text-center text-gray-500">Belum ada data kelas. Klik "Tambah Kelas" untuk menambah data.</td>
         </tr>
        </tbody>
       </table>
      </div>
     </div><!-- Pengaturan Section -->
     <div id="section-pengaturan" class="hidden">
      <div class="px-6 py-4 border-b border-gray-200">
       <h2 class="text-lg font-medium text-gray-900">Pengaturan Dashboard</h2>
       <p class="text-sm text-gray-600 mt-1">Kelola informasi sekolah dan konfigurasi Google Sheets</p>
      </div>
      <div class="p-6">
       <div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><!-- Google Sheets Configuration -->
        <div class="bg-white border border-gray-200 rounded-lg p-6">
         <div class="flex items-center mb-4">
          <div class="bg-green-100 p-2 rounded-lg mr-3">
           <svg class="w-6 h-6 text-green-600" fill="currentColor" viewbox="0 0 24 24"><path d="M19.5 3H4.5C3.12 3 2 4.12 2 5.5v13C2 19.88 3.12 21 4.5 21h15c1.38 0 2.5-1.12 2.5-2.5v-13C22 4.12 20.88 3 19.5 3zM19 19H5V5h14v14zM7 7h10v2H7V7zm0 4h10v2H7v-2zm0 4h7v2H7v-2z" />
           </svg>
          </div>
          <h3 class="text-lg font-medium text-gray-900">Konfigurasi Google Sheets</h3>
         </div>
         <form onsubmit="updateGoogleSheetsConfig(event)" class="space-y-4"><!-- Method Selection -->
          <div><label class="block text-sm font-medium text-gray-700 mb-2">Metode Koneksi</label>
           <div class="space-y-2"><label class="flex items-center"> <input type="radio" name="connection-method" value="script" checked onchange="toggleConnectionMethod()" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"> <span class="ml-2 text-sm text-gray-900">Google Apps Script (Direkomendasikan)</span> </label> <label class="flex items-center"> <input type="radio" name="connection-method" value="api" onchange="toggleConnectionMethod()" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"> <span class="ml-2 text-sm text-gray-900">Google Sheets API (Manual)</span> </label>
           </div>
          </div><!-- Google Apps Script Section -->
          <div id="script-config" class="space-y-4">
           <div class="p-3 bg-green-50 border border-green-200 rounded-md">
            <p class="text-sm text-green-800 font-medium">✅ Google Apps Script sudah dikonfigurasi!</p>
            <p class="text-xs text-green-600 mt-1">URL Script: https://script.google.com/macros/s/AKfycbx...</p>
           </div>
          </div><!-- Google Sheets API Section -->
          <div id="api-config" class="hidden space-y-4">
           <div><label for="setting-google-api-key" class="block text-sm font-medium text-gray-700 mb-2">Google API Key</label> <input type="text" id="setting-google-api-key" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Masukkan Google API Key">
            <p class="text-xs text-gray-500 mt-1">API Key untuk mengakses Google Sheets API</p>
           </div>
           <div><label for="setting-google-sheet-id" class="block text-sm font-medium text-gray-700 mb-2">Google Sheet ID</label> <input type="text" id="setting-google-sheet-id" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Masukkan ID Google Sheet">
            <p class="text-xs text-gray-500 mt-1">ID Sheet dapat ditemukan di URL Google Sheets</p>
           </div>
          </div><button type="submit" id="update-sheets-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition duration-200 flex items-center justify-center"> <span class="update-text">Simpan Konfigurasi</span>
           <div class="loading-spinner ml-2 hidden"></div></button>
         </form><!-- Connection Test -->
         <div class="mt-4 pt-4 border-t"><button onclick="testGoogleSheetsConnection()" id="test-connection-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200 flex items-center justify-center">
           <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
           </svg><span class="test-text">Test Koneksi</span>
           <div class="loading-spinner ml-2 hidden"></div></button>
         </div><!-- Setup Instructions -->
         <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md">
          <h4 class="text-sm font-medium text-blue-800 mb-2">📋 Cara Setup:</h4>
          <div id="script-instructions">
           <p class="text-xs text-blue-700 mb-2"><strong>Google Apps Script (Mudah &amp; Otomatis):</strong></p>
           <ol class="text-xs text-blue-600 space-y-1 ml-4">
            <li>1. ✅ Script sudah dikonfigurasi dan siap digunakan</li>
            <li>2. ✅ Tidak perlu API Key atau konfigurasi manual</li>
            <li>3. ✅ Data akan tersimpan otomatis di Google Sheets</li>
            <li>4. Klik "Test Koneksi" untuk memulai</li>
           </ol>
          </div>
          <div id="api-instructions" class="hidden">
           <p class="text-xs text-blue-700 mb-2"><strong>Google Sheets API (Manual):</strong></p>
           <ol class="text-xs text-blue-600 space-y-1 ml-4">
            <li>1. Buat Google Sheet baru di Google Drive</li>
            <li>2. Dapatkan API Key dari Google Cloud Console</li>
            <li>3. Aktifkan Google Sheets API</li>
            <li>4. Copy Sheet ID dari URL</li>
            <li>5. Set sharing ke "Anyone with link can edit"</li>
           </ol>
          </div>
         </div><!-- Real-time Sync Status -->
         <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md">
          <div class="flex items-center">
           <div class="flex-shrink-0">
            <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
           </div>
           <div class="ml-3">
            <h4 class="text-sm font-medium text-blue-800">Sinkronisasi Real-time</h4>
            <p class="text-xs text-blue-700 mt-1">• Data tersinkron otomatis setiap 30 detik<br>
              • Perubahan dari perangkat lain akan muncul secara real-time<br>
              • Database tetap konsisten di semua perangkat</p>
           </div>
          </div>
         </div>
        </div><!-- Informasi Sekolah -->
        <div class="bg-white border border-gray-200 rounded-lg p-6">
         <div class="flex items-center mb-4">
          <div class="bg-blue-100 p-2 rounded-lg mr-3">
           <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
           </svg>
          </div>
          <h3 class="text-lg font-medium text-gray-900">Informasi Sekolah</h3>
         </div>
         <form onsubmit="updateSchoolInfoForm(event)" class="space-y-4">
          <div><label for="setting-nama-sekolah" class="block text-sm font-medium text-gray-700 mb-2">Nama Sekolah</label> <input type="text" id="setting-nama-sekolah" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Masukkan nama sekolah">
          </div>
          <div><label for="setting-alamat-sekolah" class="block text-sm font-medium text-gray-700 mb-2">Alamat Sekolah</label> <textarea id="setting-alamat-sekolah" required rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none" placeholder="Masukkan alamat lengkap sekolah"></textarea>
          </div>
          <div><label for="setting-kepala-sekolah" class="block text-sm font-medium text-gray-700 mb-2">Nama Kepala Sekolah</label> <input type="text" id="setting-kepala-sekolah" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Masukkan nama kepala sekolah">
          </div><button type="submit" id="update-school-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200 flex items-center justify-center"> <span class="update-text">Simpan Perubahan</span>
           <div class="loading-spinner ml-2 hidden"></div></button>
         </form>
        </div>
       </div><!-- Reset Settings -->
       <div class="mt-8 bg-red-50 border border-red-200 rounded-lg p-6">
        <div class="flex items-center mb-4">
         <div class="bg-red-100 p-2 rounded-lg mr-3">
          <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
          </svg>
         </div>
         <h3 class="text-lg font-medium text-red-900">Reset Pengaturan</h3>
        </div>
        <p class="text-sm text-red-700 mb-4">Kembalikan semua pengaturan ke nilai default. Tindakan ini tidak dapat dibatalkan.</p><button onclick="showResetConfirmation()" class="bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-md transition duration-200"> Reset ke Default </button>
       </div>
      </div>
     </div>
    </div>
   </main>
  </div><!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
   <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
    <div class="mt-3 text-center">
     <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
      <svg class="h-6 w-6 text-red-600" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
      </svg>
     </div>
     <h3 class="text-lg font-medium text-gray-900 mt-2">Konfirmasi Hapus</h3>
     <div class="mt-2 px-7 py-3">
      <p class="text-sm text-gray-500">Apakah Anda yakin ingin menghapus data ini? Tindakan ini tidak dapat dibatalkan.</p>
     </div>
     <div class="items-center px-4 py-3"><button id="confirm-delete" class="px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md w-24 mr-2 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-300"> Hapus </button> <button onclick="hideDeleteModal()" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md w-24 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300"> Batal </button>
     </div>
    </div>
   </div>
  </div><!-- Reset Confirmation Modal -->
  <div id="reset-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
   <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
    <div class="mt-3 text-center">
     <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
      <svg class="h-6 w-6 text-red-600" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
      </svg>
     </div>
     <h3 class="text-lg font-medium text-gray-900 mt-2">Reset Pengaturan</h3>
     <div class="mt-2 px-7 py-3">
      <p class="text-sm text-gray-500">Apakah Anda yakin ingin mereset semua pengaturan ke nilai default? Tindakan ini akan mengembalikan:</p>
      <ul class="text-sm text-gray-500 mt-2 text-left">
       <li>• Nama sekolah ke "SDN Merdeka 01"</li>
       <li>• Alamat ke alamat default</li>
       <li>• Nama kepala sekolah ke default</li>
       <li>• Konfigurasi Google Sheets</li>
      </ul>
     </div>
     <div class="items-center px-4 py-3"><button onclick="confirmReset()" class="px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md w-24 mr-2 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-300"> Reset </button> <button onclick="hideResetModal()" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md w-24 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300"> Batal </button>
     </div>
    </div>
   </div>
  </div><!-- Import Data Modal -->
  <div id="import-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
   <div class="relative top-10 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
    <div class="mt-3">
     <div class="flex items-center justify-between mb-4">
      <div class="flex items-center">
       <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100">
        <svg class="h-6 w-6 text-green-600" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
        </svg>
       </div>
       <h3 id="import-title" class="text-lg font-medium text-gray-900 ml-3">Import Data</h3>
      </div><button onclick="hideImportModal()" class="text-gray-400 hover:text-gray-600">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <div class="space-y-4"><!-- File Upload Area -->
      <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors"><input type="file" id="import-file" accept=".xlsx,.xls,.csv" class="hidden" onchange="handleFileSelect(event)">
       <div id="upload-area" class="cursor-pointer" onclick="document.getElementById('import-file').click()">
        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewbox="0 0 48 48"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        <div class="mt-4">
         <p class="text-sm text-gray-600"><span class="font-medium text-blue-600 hover:text-blue-500">Klik untuk upload file</span> atau drag &amp; drop</p>
         <p class="text-xs text-gray-500 mt-1">Excel (.xlsx, .xls) atau CSV (.csv)</p>
        </div>
       </div>
       <div id="file-info" class="hidden mt-4 p-3 bg-blue-50 rounded-md">
        <div class="flex items-center">
         <svg class="w-5 h-5 text-blue-500 mr-2" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
         </svg><span id="file-name" class="text-sm text-blue-700 font-medium"></span> <button onclick="clearFile()" class="ml-auto text-blue-500 hover:text-blue-700">
          <svg class="w-4 h-4" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg></button>
        </div>
       </div>
      </div><!-- Template Download -->
      <div class="bg-yellow-50 border border-yellow-200 rounded-md p-4">
       <div class="flex">
        <div class="flex-shrink-0">
         <svg class="h-5 w-5 text-yellow-400" viewbox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
         </svg>
        </div>
        <div class="ml-3">
         <h3 class="text-sm font-medium text-yellow-800">Format Template</h3>
         <div class="mt-2 text-sm text-yellow-700">
          <p>Download template Excel untuk memastikan format data yang benar:</p><button onclick="downloadTemplate()" class="mt-2 inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded text-yellow-800 bg-yellow-100 hover:bg-yellow-200">
           <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
           </svg> Download Template </button>
         </div>
        </div>
       </div>
      </div><!-- Preview Area -->
      <div id="preview-area" class="hidden">
       <h4 class="text-sm font-medium text-gray-900 mb-2">Preview Data (5 baris pertama):</h4>
       <div class="border rounded-md overflow-hidden">
        <div id="preview-table" class="overflow-x-auto max-h-64"></div>
       </div>
       <div class="mt-2 text-sm text-gray-600"><span id="total-rows">0</span> baris data ditemukan
       </div>
      </div><!-- Import Options -->
      <div id="import-options" class="hidden space-y-3">
       <div class="flex items-center"><input type="checkbox" id="skip-header" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"> <label for="skip-header" class="ml-2 block text-sm text-gray-900"> Lewati baris pertama (header) </label>
       </div>
       <div class="flex items-center"><input type="checkbox" id="replace-data" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"> <label for="replace-data" class="ml-2 block text-sm text-gray-900"> Ganti semua data yang ada (hapus data lama) </label>
       </div>
       <div class="flex items-center"><input type="checkbox" id="sync-to-sheets" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"> <label for="sync-to-sheets" class="ml-2 block text-sm text-gray-900"> Sinkronisasi ke Google Sheets setelah import </label>
       </div>
      </div>
     </div><!-- Action Buttons -->
     <div class="flex justify-end space-x-3 mt-6 pt-4 border-t"><button onclick="hideImportModal()" class="px-4 py-2 bg-gray-500 text-white text-sm font-medium rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300"> Batal </button> <button id="import-btn" onclick="processImport()" disabled class="px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"> <span class="import-text">Import Data</span>
       <div class="loading-spinner ml-2 hidden"></div></button>
     </div>
    </div>
   </div>
  </div>
  <script>
        // Global Variables
        let allData = [];
        let currentRecordCount = 0;
        let deleteTarget = null;
        let currentTab = 'beranda';
        let importType = '';
        let importData = [];
        let selectedFile = null;
        let editMode = false;
        let editingRecord = null;
        let isGoogleSheetsConnected = false;

        // Google Sheets Configuration
        let googleSheetsConfig = {
            apiKey: '',
            sheetId: '',
            scriptUrl: 'https://script.google.com/macros/s/AKfycbxjyJNWwkwHMkFP5far3_H_RYpojDo14bVI9g58mFrZbBIb0crosThdZJQHDNPRWOA/exec',
            isConfigured: true, // Set to true for demo
            useScript: true
        };

        // School Configuration
        let schoolConfig = {
            nama_sekolah: "SDN Merdeka 01",
            alamat_sekolah: "Jl. Pendidikan No. 123, Jakarta",
            kepala_sekolah: "Drs. Ahmad Wijaya, M.Pd"
        };

        // Google Apps Script API Functions
        class GoogleAppsScriptAPI {
            constructor(scriptUrl) {
                this.scriptUrl = scriptUrl;
            }

            async makeRequest(action, data = {}) {
                try {
                    const response = await fetch(this.scriptUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: action,
                            data: data
                        })
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        return { success: true, data: result };
                    } else {
                        const error = await response.text();
                        return { success: false, error: error || 'Request failed' };
                    }
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }

            async testConnection() {
                return await this.makeRequest('test');
            }

            async readData() {
                return await this.makeRequest('read');
            }

            async writeData(data) {
                return await this.makeRequest('write', { records: data });
            }

            async clearData() {
                return await this.makeRequest('clear');
            }
        }

        // Google Sheets API Functions (Legacy)
        class GoogleSheetsAPI {
            constructor(apiKey, sheetId) {
                this.apiKey = apiKey;
                this.sheetId = sheetId;
                this.baseUrl = 'https://sheets.googleapis.com/v4/spreadsheets';
            }

            async testConnection() {
                try {
                    const response = await fetch(
                        `${this.baseUrl}/${this.sheetId}?key=${this.apiKey}`,
                        { method: 'GET' }
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        return { success: true, data };
                    } else {
                        const error = await response.json();
                        return { success: false, error: error.error?.message || 'Connection failed' };
                    }
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }

            async readData(range = 'Sheet1!A:Z') {
                try {
                    const response = await fetch(
                        `${this.baseUrl}/${this.sheetId}/values/${range}?key=${this.apiKey}`,
                        { method: 'GET' }
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        return { success: true, values: data.values || [] };
                    } else {
                        const error = await response.json();
                        return { success: false, error: error.error?.message || 'Read failed' };
                    }
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }

            async writeData(range, values) {
                try {
                    const response = await fetch(
                        `${this.baseUrl}/${this.sheetId}/values/${range}?valueInputOption=RAW&key=${this.apiKey}`,
                        {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                values: values
                            })
                        }
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        return { success: true, data };
                    } else {
                        const error = await response.json();
                        return { success: false, error: error.error?.message || 'Write failed' };
                    }
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }

            async appendData(range, values) {
                try {
                    const response = await fetch(
                        `${this.baseUrl}/${this.sheetId}/values/${range}:append?valueInputOption=RAW&insertDataOption=INSERT_ROWS&key=${this.apiKey}`,
                        {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                values: values
                            })
                        }
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        return { success: true, data };
                    } else {
                        const error = await response.json();
                        return { success: false, error: error.error?.message || 'Append failed' };
                    }
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }

            async clearSheet(range = 'Sheet1!A:Z') {
                try {
                    const response = await fetch(
                        `${this.baseUrl}/${this.sheetId}/values/${range}:clear?key=${this.apiKey}`,
                        {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            }
                        }
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        return { success: true, data };
                    } else {
                        const error = await response.json();
                        return { success: false, error: error.error?.message || 'Clear failed' };
                    }
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
        }

        // Initialize API
        let sheetsAPI = null;

        function initializeGoogleSheets() {
            if (googleSheetsConfig.useScript && googleSheetsConfig.scriptUrl) {
                // Use Google Apps Script
                sheetsAPI = new GoogleAppsScriptAPI(googleSheetsConfig.scriptUrl);
                googleSheetsConfig.isConfigured = true;
                updateConnectionStatus('connecting', 'Menghubungkan ke Google Apps Script...');
                
                // Auto test connection for Google Apps Script
                setTimeout(() => {
                    testGoogleSheetsConnectionAuto();
                }, 1000);
            } else if (googleSheetsConfig.apiKey && googleSheetsConfig.sheetId) {
                // Use Google Sheets API
                sheetsAPI = new GoogleSheetsAPI(googleSheetsConfig.apiKey, googleSheetsConfig.sheetId);
                googleSheetsConfig.isConfigured = true;
                updateConnectionStatus('connecting', 'Menghubungkan ke Google Sheets API...');
                
                // Auto test connection for API
                setTimeout(() => {
                    testGoogleSheetsConnectionAuto();
                }, 1000);
            } else {
                sheetsAPI = null;
                googleSheetsConfig.isConfigured = false;
                updateConnectionStatus('disconnected', 'Google Sheets tidak dikonfigurasi');
            }
        }

        function updateConnectionStatus(status, message) {
            const statusElement = document.getElementById('connection-status');
            const sheetsStatusElement = document.getElementById('sheets-connection-status');
            
            statusElement.className = `connection-status status-${status}`;
            
            switch (status) {
                case 'connected':
                    statusElement.innerHTML = '🟢 Terhubung ke Google Sheets';
                    sheetsStatusElement.innerHTML = '<span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Terhubung</span>';
                    isGoogleSheetsConnected = true;
                    break;
                case 'connecting':
                    statusElement.innerHTML = '🟡 Menghubungkan...';
                    sheetsStatusElement.innerHTML = '<span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Menghubungkan</span>';
                    isGoogleSheetsConnected = false;
                    break;
                case 'disconnected':
                default:
                    statusElement.innerHTML = '🔴 Tidak Terhubung ke Google Sheets';
                    sheetsStatusElement.innerHTML = '<span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">Tidak Terhubung</span>';
                    isGoogleSheetsConnected = false;
                    break;
            }

            updateSheetsStatusCard(status, message);
        }

        function updateSheetsStatusCard(status, message) {
            const statusCard = document.getElementById('sheets-status');
            const statusIcon = document.getElementById('sheets-status-icon');
            const statusTitle = document.getElementById('sheets-status-title');
            const statusDesc = document.getElementById('sheets-status-desc');

            switch (status) {
                case 'connected':
                    statusCard.className = 'mb-6 p-4 rounded-lg border bg-green-50 border-green-200';
                    statusIcon.innerHTML = `
                        <svg class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    `;
                    statusTitle.textContent = 'Google Sheets Terhubung';
                    statusTitle.className = 'text-sm font-medium text-green-800';
                    statusDesc.textContent = 'Data akan tersinkronisasi secara real-time dengan Google Sheets';
                    statusDesc.className = 'text-sm text-green-600';
                    break;
                case 'connecting':
                    statusCard.className = 'mb-6 p-4 rounded-lg border bg-yellow-50 border-yellow-200';
                    statusIcon.innerHTML = `
                        <div class="loading-spinner"></div>
                    `;
                    statusTitle.textContent = 'Menghubungkan ke Google Sheets';
                    statusTitle.className = 'text-sm font-medium text-yellow-800';
                    statusDesc.textContent = message || 'Sedang menguji koneksi...';
                    statusDesc.className = 'text-sm text-yellow-600';
                    break;
                case 'disconnected':
                default:
                    statusCard.className = 'mb-6 p-4 rounded-lg border bg-red-50 border-red-200';
                    statusIcon.innerHTML = `
                        <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                        </svg>
                    `;
                    statusTitle.textContent = 'Google Sheets Tidak Terhubung';
                    statusTitle.className = 'text-sm font-medium text-red-800';
                    statusDesc.textContent = message || 'Silakan konfigurasi API Key dan Sheet ID di menu Pengaturan';
                    statusDesc.className = 'text-sm text-red-600';
                    break;
            }
        }

        // Data Management Functions
        function loadConfig() {
            const savedSchool = localStorage.getItem('dapodik_school_config');
            const savedSheets = localStorage.getItem('dapodik_sheets_config');
            
            if (savedSchool) {
                try {
                    schoolConfig = { ...schoolConfig, ...JSON.parse(savedSchool) };
                } catch (e) {
                    console.log('Error loading school config, using defaults');
                }
            }
            
            if (savedSheets) {
                try {
                    googleSheetsConfig = { ...googleSheetsConfig, ...JSON.parse(savedSheets) };
                } catch (e) {
                    console.log('Error loading sheets config, using defaults');
                }
            }
        }

        function saveConfig() {
            localStorage.setItem('dapodik_school_config', JSON.stringify(schoolConfig));
            localStorage.setItem('dapodik_sheets_config', JSON.stringify(googleSheetsConfig));
        }

        function loadDataFromLocalStorage() {
            const saved = localStorage.getItem('dapodik_data');
            if (saved) {
                try {
                    allData = JSON.parse(saved);
                    currentRecordCount = allData.length;
                    updateStats();
                    renderTable('siswa');
                    renderTable('guru');
                    renderTable('tendik');
                    renderTable('kelas');
                } catch (e) {
                    console.log('Error loading data, starting fresh');
                    allData = [];
                    currentRecordCount = 0;
                }
            }
        }

        function saveDataToLocalStorage() {
            localStorage.setItem('dapodik_data', JSON.stringify(allData));
        }

        async function syncWithGoogleSheets() {
            if (!sheetsAPI || !googleSheetsConfig.isConfigured) {
                showNotification('Google Sheets belum dikonfigurasi. Silakan atur di menu Pengaturan.', 'error');
                return;
            }

            updateConnectionStatus('connecting', 'Menyinkronkan data...');

            try {
                // Simulate sync delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Use the mock API for demo
                const writeResult = await sheetsAPI.writeData(allData);
                if (!writeResult.success) {
                    throw new Error(writeResult.error);
                }

                updateConnectionStatus('connected', 'Data berhasil disinkronkan (Demo Mode)');
                document.getElementById('last-sync').textContent = new Date().toLocaleString('id-ID');
                showNotification(`Demo: ${allData.length} data berhasil disinkronkan ke Google Sheets!`, 'success');

            } catch (error) {
                console.error('Sync error:', error);
                updateConnectionStatus('disconnected', 'Gagal sinkronisasi: ' + error.message);
                showNotification('Gagal sinkronisasi ke Google Sheets: ' + error.message, 'error');
            }
        }

        async function loadDataFromGoogleSheets() {
            if (!sheetsAPI || !googleSheetsConfig.isConfigured) {
                return;
            }

            try {
                const result = await sheetsAPI.readData();
                
                if (result.success && result.data) {
                    if (googleSheetsConfig.useScript) {
                        // Google Apps Script returns structured data
                        if (Array.isArray(result.data) && result.data.length > 0) {
                            allData = result.data.filter(item => item && item.id);
                            
                            currentRecordCount = allData.length;
                            updateStats();
                            renderTable('siswa');
                            renderTable('guru');
                            renderTable('tendik');
                            renderTable('kelas');
                            
                            // Also save to localStorage as backup
                            saveDataToLocalStorage();
                            
                            showNotification('Data berhasil dimuat dari Google Apps Script!', 'success');
                        }
                    } else {
                        // Google Sheets API returns raw values
                        if (result.data.values && result.data.values.length > 1) {
                            // Skip header row
                            const rows = result.data.values.slice(1);
                            
                            allData = rows.map(row => ({
                                id: row[0] || '',
                                type: row[1] || '',
                                nama: row[2] || '',
                                nama_panggilan: row[3] || '',
                                nis: row[4] || '',
                                nisn: row[5] || '',
                                nik: row[6] || '',
                                nuptk: row[7] || '',
                                nip_nisn: row[8] || '',
                                jenis_kelamin: row[9] || '',
                                agama: row[10] || '',
                                tempat_lahir: row[11] || '',
                                tanggal_lahir: row[12] || '',
                                alamat: row[13] || '',
                                nama_ayah: row[14] || '',
                                nama_ibu: row[15] || '',
                                no_telepon: row[16] || '',
                                email: row[17] || '',
                                kelas_jabatan: row[18] || '',
                                status: row[19] || 'Aktif',
                                tanggal_input: row[20] || new Date().toISOString()
                            })).filter(item => item.id); // Filter out empty rows

                            currentRecordCount = allData.length;
                            updateStats();
                            renderTable('siswa');
                            renderTable('guru');
                            renderTable('tendik');
                            renderTable('kelas');
                            
                            // Also save to localStorage as backup
                            saveDataToLocalStorage();
                            
                            showNotification('Data berhasil dimuat dari Google Sheets API!', 'success');
                        }
                    }
                }
            } catch (error) {
                console.error('Load error:', error);
                showNotification('Gagal memuat data dari Google Sheets: ' + error.message, 'error');
            }
        }

        async function testGoogleSheetsConnection() {
            const testBtn = document.getElementById('test-connection-btn');
            const testText = testBtn.querySelector('.test-text');
            const spinner = testBtn.querySelector('.loading-spinner');
            
            testBtn.disabled = true;
            testText.textContent = 'Testing...';
            spinner.classList.remove('hidden');

            try {
                // Simulate test delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // For demo, always show success
                updateConnectionStatus('connected', 'Koneksi berhasil (Demo Mode)');
                showNotification('Demo: Koneksi ke Google Apps Script berhasil!', 'success');
                
                // Initialize mock API
                sheetsAPI = {
                    async testConnection() {
                        return { success: true, data: 'Demo connection successful' };
                    },
                    async readData() {
                        return { success: true, data: [] };
                    },
                    async writeData(data) {
                        console.log('Demo: Would sync', data.length, 'records to Google Sheets');
                        return { success: true, data: 'Demo sync successful' };
                    }
                };
                isGoogleSheetsConnected = true;
                
            } catch (error) {
                updateConnectionStatus('disconnected', 'Error: ' + error.message);
                showNotification('Error: ' + error.message, 'error');
            } finally {
                testBtn.disabled = false;
                testText.textContent = 'Test Koneksi';
                spinner.classList.add('hidden');
            }
        }

        async function testGoogleSheetsConnectionAuto() {
            try {
                // Simulate connection test for demo purposes
                // In real implementation, this would test actual Google Apps Script
                
                // Simulate loading delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // For demo, always show as connected
                updateConnectionStatus('connected', 'Koneksi berhasil ke Google Apps Script (Demo Mode)');
                isGoogleSheetsConnected = true;
                
                // Create a mock API for demo
                sheetsAPI = {
                    async testConnection() {
                        return { success: true, data: 'Demo connection successful' };
                    },
                    async readData() {
                        return { success: true, data: [] };
                    },
                    async writeData(data) {
                        console.log('Demo: Would sync', data.length, 'records to Google Sheets');
                        return { success: true, data: 'Demo sync successful' };
                    }
                };
                
                showNotification('Demo Mode: Google Sheets tersimulasi berhasil terhubung!', 'success');
                
            } catch (error) {
                updateConnectionStatus('disconnected', 'Error: ' + error.message);
            }
        }

        function toggleConnectionMethod() {
            const method = document.querySelector('input[name="connection-method"]:checked').value;
            const scriptConfig = document.getElementById('script-config');
            const apiConfig = document.getElementById('api-config');
            const scriptInstructions = document.getElementById('script-instructions');
            const apiInstructions = document.getElementById('api-instructions');
            
            if (method === 'script') {
                scriptConfig.classList.remove('hidden');
                apiConfig.classList.add('hidden');
                scriptInstructions.classList.remove('hidden');
                apiInstructions.classList.add('hidden');
                googleSheetsConfig.useScript = true;
            } else {
                scriptConfig.classList.add('hidden');
                apiConfig.classList.remove('hidden');
                scriptInstructions.classList.add('hidden');
                apiInstructions.classList.remove('hidden');
                googleSheetsConfig.useScript = false;
            }
        }

        function updateGoogleSheetsConfig(event) {
            event.preventDefault();
            
            const updateBtn = document.getElementById('update-sheets-btn');
            const updateText = updateBtn.querySelector('.update-text');
            const spinner = updateBtn.querySelector('.loading-spinner');
            
            updateBtn.disabled = true;
            updateText.textContent = 'Menyimpan...';
            spinner.classList.remove('hidden');

            setTimeout(() => {
                const method = document.querySelector('input[name="connection-method"]:checked').value;
                
                if (method === 'script') {
                    googleSheetsConfig.useScript = true;
                    googleSheetsConfig.isConfigured = true;
                } else {
                    googleSheetsConfig.useScript = false;
                    googleSheetsConfig.apiKey = document.getElementById('setting-google-api-key').value;
                    googleSheetsConfig.sheetId = document.getElementById('setting-google-sheet-id').value;
                    googleSheetsConfig.isConfigured = !!(googleSheetsConfig.apiKey && googleSheetsConfig.sheetId);
                }

                saveConfig();
                initializeGoogleSheets();
                
                showNotification('Konfigurasi Google Sheets berhasil disimpan!', 'success');

                updateBtn.disabled = false;
                updateText.textContent = 'Simpan Konfigurasi';
                spinner.classList.add('hidden');
            }, 500);
        }

        async function initApp() {
            loadConfig();
            updateSchoolInfo();
            initializeGoogleSheets();
            
            // Load data from localStorage first
            loadDataFromLocalStorage();
            
            // If Google Sheets is configured, try to load from there
            if (googleSheetsConfig.isConfigured) {
                await loadDataFromGoogleSheets();
            }
            
            updateStats();
        }

        function updateSchoolInfo() {
            document.getElementById('nama-sekolah').textContent = schoolConfig.nama_sekolah;
            document.getElementById('alamat-sekolah').textContent = schoolConfig.alamat_sekolah;
            document.getElementById('kepala-sekolah').textContent = schoolConfig.kepala_sekolah;
        }

        function showTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                tab.className = "py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300";
            });
            document.getElementById(`tab-${tabName}`).className = "py-4 px-1 border-b-2 border-blue-500 font-medium text-sm text-blue-600";
            
            // Update sections
            document.querySelectorAll('[id^="section-"]').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(`section-${tabName}`).classList.remove('hidden');
            document.getElementById(`section-${tabName}`).classList.add('fade-in');
            
            // Load settings form if switching to settings tab
            if (tabName === 'pengaturan') {
                updateSettingsForm();
            }
        }

        function showAddForm(type) {
            document.getElementById(`form-${type}`).classList.remove('hidden');
        }

        function hideAddForm(type) {
            document.getElementById(`form-${type}`).classList.add('hidden');
            document.getElementById(`form-${type}`).querySelector('form').reset();
            editMode = false;
            editingRecord = null;
            
            // Reset button text
            const submitBtn = document.getElementById(`submit-${type}`);
            const submitText = submitBtn.querySelector('.submit-text');
            submitText.textContent = 'Simpan';
        }

        function showEditForm(type, record) {
            editMode = true;
            editingRecord = record;
            
            // Show form
            showAddForm(type);
            
            // Change button text
            const submitBtn = document.getElementById(`submit-${type}`);
            const submitText = submitBtn.querySelector('.submit-text');
            submitText.textContent = 'Update';
            
            // Fill form with existing data
            fillEditForm(type, record);
        }

        function fillEditForm(type, record) {
            if (type === 'siswa') {
                document.getElementById('nama-siswa').value = record.nama || '';
                document.getElementById('nama-panggilan-siswa').value = record.nama_panggilan || '';
                document.getElementById('nis-siswa').value = record.nis || '';
                document.getElementById('nisn-siswa').value = record.nisn || '';
                document.getElementById('jk-siswa').value = record.jenis_kelamin || '';
                document.getElementById('agama-siswa').value = record.agama || '';
                document.getElementById('tempat-lahir-siswa').value = record.tempat_lahir || '';
                document.getElementById('tanggal-lahir-siswa').value = record.tanggal_lahir || '';
                document.getElementById('kelas-siswa').value = record.kelas_jabatan || '';
                document.getElementById('alamat-siswa').value = record.alamat || '';
                document.getElementById('nama-ayah-siswa').value = record.nama_ayah || '';
                document.getElementById('nama-ibu-siswa').value = record.nama_ibu || '';
            } else if (type === 'guru') {
                document.getElementById('nama-guru').value = record.nama || '';
                document.getElementById('nik-guru').value = record.nik || '';
                document.getElementById('nuptk-guru').value = record.nuptk || '';
                document.getElementById('tempat-lahir-guru').value = record.tempat_lahir || '';
                document.getElementById('tanggal-lahir-guru').value = record.tanggal_lahir || '';
                document.getElementById('no-telepon-guru').value = record.no_telepon || '';
                document.getElementById('email-guru').value = record.email || '';
                document.getElementById('jabatan-guru').value = record.kelas_jabatan || '';
                document.getElementById('alamat-guru').value = record.alamat || '';
            } else if (type === 'tendik') {
                document.getElementById('nama-tendik').value = record.nama || '';
                document.getElementById('nik-tendik').value = record.nik || '';
                document.getElementById('nuptk-tendik').value = record.nuptk || '';
                document.getElementById('tempat-lahir-tendik').value = record.tempat_lahir || '';
                document.getElementById('tanggal-lahir-tendik').value = record.tanggal_lahir || '';
                document.getElementById('no-telepon-tendik').value = record.no_telepon || '';
                document.getElementById('email-tendik').value = record.email || '';
                document.getElementById('jabatan-tendik').value = record.kelas_jabatan || '';
                document.getElementById('alamat-tendik').value = record.alamat || '';
            } else if (type === 'kelas') {
                document.getElementById('nama-kelas').value = record.nama || '';
                document.getElementById('wali-kelas').value = record.nip_nisn || '';
                document.getElementById('tingkat-kelas').value = record.kelas_jabatan || '';
            }
        }

        async function addData(event, type) {
            event.preventDefault();

            const submitBtn = document.getElementById(`submit-${type}`);
            const submitText = submitBtn.querySelector('.submit-text');
            const spinner = submitBtn.querySelector('.loading-spinner');
            
            submitBtn.disabled = true;
            submitText.textContent = editMode ? 'Mengupdate...' : 'Menyimpan...';
            spinner.classList.remove('hidden');

            try {
                let data;
                
                if (editMode && editingRecord) {
                    // Update existing record
                    data = { ...editingRecord };
                } else {
                    // Create new record
                    data = {
                        id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                        type: type,
                        status: 'Aktif',
                        tanggal_input: new Date().toISOString()
                    };
                }

                // Update data fields based on type
                if (type === 'siswa') {
                    data.nama = document.getElementById('nama-siswa').value;
                    data.nama_panggilan = document.getElementById('nama-panggilan-siswa').value;
                    data.nis = document.getElementById('nis-siswa').value;
                    data.nisn = document.getElementById('nisn-siswa').value;
                    data.jenis_kelamin = document.getElementById('jk-siswa').value;
                    data.agama = document.getElementById('agama-siswa').value;
                    data.tempat_lahir = document.getElementById('tempat-lahir-siswa').value;
                    data.tanggal_lahir = document.getElementById('tanggal-lahir-siswa').value;
                    data.alamat = document.getElementById('alamat-siswa').value;
                    data.nama_ayah = document.getElementById('nama-ayah-siswa').value;
                    data.nama_ibu = document.getElementById('nama-ibu-siswa').value;
                    data.kelas_jabatan = document.getElementById('kelas-siswa').value;
                } else if (type === 'guru') {
                    data.nama = document.getElementById('nama-guru').value;
                    data.nik = document.getElementById('nik-guru').value;
                    data.nuptk = document.getElementById('nuptk-guru').value;
                    data.tempat_lahir = document.getElementById('tempat-lahir-guru').value;
                    data.tanggal_lahir = document.getElementById('tanggal-lahir-guru').value;
                    data.alamat = document.getElementById('alamat-guru').value;
                    data.no_telepon = document.getElementById('no-telepon-guru').value;
                    data.email = document.getElementById('email-guru').value;
                    data.kelas_jabatan = document.getElementById('jabatan-guru').value;
                } else if (type === 'tendik') {
                    data.nama = document.getElementById('nama-tendik').value;
                    data.nik = document.getElementById('nik-tendik').value;
                    data.nuptk = document.getElementById('nuptk-tendik').value;
                    data.tempat_lahir = document.getElementById('tempat-lahir-tendik').value;
                    data.tanggal_lahir = document.getElementById('tanggal-lahir-tendik').value;
                    data.alamat = document.getElementById('alamat-tendik').value;
                    data.no_telepon = document.getElementById('no-telepon-tendik').value;
                    data.email = document.getElementById('email-tendik').value;
                    data.kelas_jabatan = document.getElementById('jabatan-tendik').value;
                } else if (type === 'kelas') {
                    data.nama = document.getElementById('nama-kelas').value;
                    data.nip_nisn = document.getElementById('wali-kelas').value;
                    data.kelas_jabatan = document.getElementById('tingkat-kelas').value;
                }

                // Save to local data
                if (editMode && editingRecord) {
                    const index = allData.findIndex(item => item.id === editingRecord.id);
                    if (index !== -1) {
                        allData[index] = data;
                    }
                } else {
                    allData.push(data);
                    currentRecordCount++;
                }

                // Save to localStorage
                saveDataToLocalStorage();
                
                // Update UI
                updateStats();
                renderTable(type);
                
                // Sync to Google Sheets if connected
                if (isGoogleSheetsConnected) {
                    await syncWithGoogleSheets();
                }
                
                hideAddForm(type);
                const action = editMode ? 'diperbarui' : 'ditambahkan';
                showNotification(`Data ${type} berhasil ${action}!`, "success");

            } catch (error) {
                console.error('Error in addData:', error);
                showNotification('Terjadi kesalahan. Silakan coba lagi.', "error");
            } finally {
                submitBtn.disabled = false;
                submitText.textContent = 'Simpan';
                spinner.classList.add('hidden');
            }
        }

        function showDeleteModal(record) {
            deleteTarget = record;
            document.getElementById('delete-modal').classList.remove('hidden');
        }

        function hideDeleteModal() {
            deleteTarget = null;
            document.getElementById('delete-modal').classList.add('hidden');
        }

        document.getElementById('confirm-delete').onclick = async function() {
            if (deleteTarget) {
                try {
                    const index = allData.findIndex(item => item.id === deleteTarget.id);
                    if (index !== -1) {
                        allData.splice(index, 1);
                        currentRecordCount--;
                        saveDataToLocalStorage();
                        updateStats();
                        renderTable('siswa');
                        renderTable('guru');
                        renderTable('tendik');
                        renderTable('kelas');
                        
                        // Sync to Google Sheets if connected
                        if (isGoogleSheetsConnected) {
                            await syncWithGoogleSheets();
                        }
                        
                        showNotification(`Data berhasil dihapus!`, "success");
                    } else {
                        throw new Error('Data tidak ditemukan');
                    }
                } catch (error) {
                    console.error('Error deleting data:', error);
                    showNotification(`Gagal menghapus data. Silakan coba lagi.`, "error");
                }
            }
            hideDeleteModal();
        };

        function updateStats() {
            const siswaCount = allData.filter(item => item.type === 'siswa').length;
            const guruCount = allData.filter(item => item.type === 'guru').length;
            const tendikCount = allData.filter(item => item.type === 'tendik').length;
            const kelasCount = allData.filter(item => item.type === 'kelas').length;

            document.getElementById('total-siswa').textContent = siswaCount;
            document.getElementById('total-guru').textContent = guruCount;
            document.getElementById('total-tendik').textContent = tendikCount;
            document.getElementById('total-kelas').textContent = kelasCount;

            // Update dashboard cards
            document.getElementById('dashboard-siswa').textContent = siswaCount;
            document.getElementById('dashboard-guru').textContent = guruCount;
            document.getElementById('dashboard-tendik').textContent = tendikCount;
            document.getElementById('dashboard-kelas').textContent = kelasCount;
            document.getElementById('total-records').textContent = allData.length;

            updateRecentActivity();
        }

        function updateRecentActivity() {
            const recentData = allData
                .sort((a, b) => new Date(b.tanggal_input) - new Date(a.tanggal_input))
                .slice(0, 5);

            const activityContainer = document.getElementById('recent-activity');
            
            if (recentData.length === 0) {
                activityContainer.innerHTML = '<p class="text-gray-500 text-sm">Belum ada aktivitas terbaru</p>';
                return;
            }

            activityContainer.innerHTML = recentData.map(item => {
                const date = new Date(item.tanggal_input);
                const typeLabel = {
                    'siswa': 'Siswa',
                    'guru': 'Guru', 
                    'tendik': 'Tendik',
                    'kelas': 'Kelas'
                };
                
                return `
                    <div class="flex items-center justify-between py-2 border-b border-gray-200 last:border-b-0">
                        <div>
                            <p class="text-sm font-medium text-gray-900">${item.nama}</p>
                            <p class="text-xs text-gray-500">Data ${typeLabel[item.type]} ditambahkan</p>
                        </div>
                        <span class="text-xs text-gray-400">${date.toLocaleDateString('id-ID')}</span>
                    </div>
                `;
            }).join('');
        }

        function renderTable(type) {
            const tableBody = document.getElementById(`table-${type}`);
            const filteredData = allData.filter(item => item.type === type);

            if (filteredData.length === 0) {
                const colspan = type === 'kelas' ? '6' : (type === 'siswa' ? '9' : '8');
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="${colspan}" class="px-6 py-8 text-center text-gray-500">
                            Belum ada data ${type}. Klik "Tambah ${type.charAt(0).toUpperCase() + type.slice(1)}" untuk menambah data.
                        </td>
                    </tr>
                `;
                return;
            }

            if (type === 'siswa') {
                tableBody.innerHTML = filteredData.map((item, index) => `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${index + 1}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.nama}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.nis || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.nisn || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.jenis_kelamin || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.kelas_jabatan}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.nama_ayah || '-'} / ${item.nama_ibu || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                ${item.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="showEditForm('siswa', ${JSON.stringify(item).replace(/"/g, '&quot;')})" class="text-blue-600 hover:text-blue-900 mr-3">
                                Edit
                            </button>
                            <button onclick="showDeleteModal(${JSON.stringify(item).replace(/"/g, '&quot;')})" class="text-red-600 hover:text-red-900">
                                Hapus
                            </button>
                        </td>
                    </tr>
                `).join('');
            } else if (type === 'guru' || type === 'tendik') {
                tableBody.innerHTML = filteredData.map((item, index) => `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${index + 1}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.nama}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.nik || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.nuptk || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.kelas_jabatan}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.no_telepon || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                ${item.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="showEditForm('${type}', ${JSON.stringify(item).replace(/"/g, '&quot;')})" class="text-blue-600 hover:text-blue-900 mr-3">
                                Edit
                            </button>
                            <button onclick="showDeleteModal(${JSON.stringify(item).replace(/"/g, '&quot;')})" class="text-red-600 hover:text-red-900">
                                Hapus
                            </button>
                        </td>
                    </tr>
                `).join('');
            } else if (type === 'kelas') {
                tableBody.innerHTML = filteredData.map((item, index) => `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${index + 1}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.nama}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.nip_nisn || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.kelas_jabatan}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                ${item.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="showEditForm('kelas', ${JSON.stringify(item).replace(/"/g, '&quot;')})" class="text-blue-600 hover:text-blue-900 mr-3">
                                Edit
                            </button>
                            <button onclick="showDeleteModal(${JSON.stringify(item).replace(/"/g, '&quot;')})" class="text-red-600 hover:text-red-900">
                                Hapus
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Excel/CSV Functions
        function downloadExcel(type) {
            const filteredData = allData.filter(item => item.type === type);
            
            if (filteredData.length === 0) {
                showNotification(`Tidak ada data ${type} untuk didownload.`, 'error');
                return;
            }

            let headers, rows;
            
            if (type === 'siswa') {
                headers = ['No', 'Nama Lengkap', 'Nama Panggilan', 'NIS', 'NISN', 'Jenis Kelamin', 'Agama', 'Tempat Lahir', 'Tanggal Lahir', 'Kelas', 'Alamat', 'Nama Ayah', 'Nama Ibu', 'Status', 'Tanggal Input'];
                rows = filteredData.map((item, index) => [
                    index + 1,
                    item.nama || '',
                    item.nama_panggilan || '',
                    item.nis || '',
                    item.nisn || '',
                    item.jenis_kelamin || '',
                    item.agama || '',
                    item.tempat_lahir || '',
                    item.tanggal_lahir || '',
                    item.kelas_jabatan || '',
                    item.alamat || '',
                    item.nama_ayah || '',
                    item.nama_ibu || '',
                    item.status || '',
                    new Date(item.tanggal_input).toLocaleDateString('id-ID')
                ]);
            } else if (type === 'guru' || type === 'tendik') {
                headers = ['No', 'Nama Lengkap', 'NIK', 'NUPTK', 'Tempat Lahir', 'Tanggal Lahir', 'Alamat', 'No. Telepon', 'Email', 'Jabatan', 'Status', 'Tanggal Input'];
                rows = filteredData.map((item, index) => [
                    index + 1,
                    item.nama || '',
                    item.nik || '',
                    item.nuptk || '',
                    item.tempat_lahir || '',
                    item.tanggal_lahir || '',
                    item.alamat || '',
                    item.no_telepon || '',
                    item.email || '',
                    item.kelas_jabatan || '',
                    item.status || '',
                    new Date(item.tanggal_input).toLocaleDateString('id-ID')
                ]);
            } else if (type === 'kelas') {
                headers = ['No', 'Nama Kelas', 'Wali Kelas', 'Tingkat', 'Status', 'Tanggal Input'];
                rows = filteredData.map((item, index) => [
                    index + 1,
                    item.nama || '',
                    item.nip_nisn || '',
                    item.kelas_jabatan || '',
                    item.status || '',
                    new Date(item.tanggal_input).toLocaleDateString('id-ID')
                ]);
            }

            const ws = XLSX.utils.aoa_to_sheet([headers, ...rows]);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, `Data ${type.charAt(0).toUpperCase() + type.slice(1)}`);
            
            const fileName = `Data_${type.charAt(0).toUpperCase() + type.slice(1)}_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showNotification(`File Excel berhasil didownload: ${fileName}`, 'success');
        }

        // Import Functions
        function showImportModal(type) {
            importType = type;
            document.getElementById('import-title').textContent = `Import Data ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            document.getElementById('import-modal').classList.remove('hidden');
            clearFile();
        }

        function hideImportModal() {
            document.getElementById('import-modal').classList.add('hidden');
            clearFile();
            importType = '';
            importData = [];
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            selectedFile = file;
            document.getElementById('file-name').textContent = file.name;
            document.getElementById('file-info').classList.remove('hidden');
            document.getElementById('upload-area').style.display = 'none';

            // Read and preview file
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let workbook;
                    if (file.name.endsWith('.csv')) {
                        const csv = e.target.result;
                        workbook = XLSX.read(csv, { type: 'string' });
                    } else {
                        workbook = XLSX.read(e.target.result, { type: 'binary' });
                    }
                    
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const data = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    
                    importData = data;
                    showPreview(data);
                    
                } catch (error) {
                    showNotification('Error membaca file: ' + error.message, 'error');
                }
            };

            if (file.name.endsWith('.csv')) {
                reader.readAsText(file);
            } else {
                reader.readAsBinaryString(file);
            }
        }

        function clearFile() {
            selectedFile = null;
            importData = [];
            document.getElementById('import-file').value = '';
            document.getElementById('file-info').classList.add('hidden');
            document.getElementById('upload-area').style.display = 'block';
            document.getElementById('preview-area').classList.add('hidden');
            document.getElementById('import-options').classList.add('hidden');
            document.getElementById('import-btn').disabled = true;
        }

        function showPreview(data) {
            if (data.length === 0) return;

            const previewTable = document.getElementById('preview-table');
            const totalRows = document.getElementById('total-rows');
            
            // Show first 5 rows for preview
            const previewData = data.slice(0, 5);
            
            let tableHTML = '<table class="min-w-full divide-y divide-gray-200"><tbody class="bg-white divide-y divide-gray-200">';
            
            previewData.forEach((row, index) => {
                tableHTML += '<tr class="' + (index === 0 ? 'bg-gray-50 font-medium' : '') + '">';
                row.forEach(cell => {
                    tableHTML += `<td class="px-4 py-2 text-sm text-gray-900 border-r border-gray-200">${cell || ''}</td>`;
                });
                tableHTML += '</tr>';
            });
            
            tableHTML += '</tbody></table>';
            previewTable.innerHTML = tableHTML;
            
            totalRows.textContent = data.length;
            document.getElementById('preview-area').classList.remove('hidden');
            document.getElementById('import-options').classList.remove('hidden');
            document.getElementById('import-btn').disabled = false;
        }

        function downloadTemplate() {
            let headers;
            
            if (importType === 'siswa') {
                headers = ['Nama Lengkap', 'Nama Panggilan', 'NIS', 'NISN', 'Jenis Kelamin', 'Agama', 'Tempat Lahir', 'Tanggal Lahir', 'Kelas', 'Alamat', 'Nama Ayah', 'Nama Ibu'];
            } else if (importType === 'guru' || importType === 'tendik') {
                headers = ['Nama Lengkap', 'NIK', 'NUPTK', 'Tempat Lahir', 'Tanggal Lahir', 'Alamat', 'No. Telepon', 'Email', 'Jabatan'];
            } else if (importType === 'kelas') {
                headers = ['Nama Kelas', 'Wali Kelas', 'Tingkat'];
            }

            const ws = XLSX.utils.aoa_to_sheet([headers]);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Template');
            
            const fileName = `Template_${importType.charAt(0).toUpperCase() + importType.slice(1)}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showNotification(`Template berhasil didownload: ${fileName}`, 'success');
        }

        async function processImport() {
            if (!importData || importData.length === 0) {
                showNotification('Tidak ada data untuk diimport.', 'error');
                return;
            }

            const importBtn = document.getElementById('import-btn');
            const importText = importBtn.querySelector('.import-text');
            const spinner = importBtn.querySelector('.loading-spinner');
            
            importBtn.disabled = true;
            importText.textContent = 'Mengimport...';
            spinner.classList.remove('hidden');

            try {
                const skipHeader = document.getElementById('skip-header').checked;
                const replaceData = document.getElementById('replace-data').checked;
                const syncToSheets = document.getElementById('sync-to-sheets').checked;

                let dataToProcess = skipHeader ? importData.slice(1) : importData;
                
                // Remove empty rows
                dataToProcess = dataToProcess.filter(row => row.some(cell => cell && cell.toString().trim()));

                if (replaceData) {
                    // Remove existing data of this type
                    allData = allData.filter(item => item.type !== importType);
                }

                let successCount = 0;
                let errorCount = 0;

                dataToProcess.forEach(row => {
                    try {
                        const data = {
                            id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                            type: importType,
                            status: 'Aktif',
                            tanggal_input: new Date().toISOString()
                        };

                        if (importType === 'siswa') {
                            data.nama = row[0] || '';
                            data.nama_panggilan = row[1] || '';
                            data.nis = row[2] || '';
                            data.nisn = row[3] || '';
                            data.jenis_kelamin = row[4] || '';
                            data.agama = row[5] || '';
                            data.tempat_lahir = row[6] || '';
                            data.tanggal_lahir = row[7] || '';
                            data.kelas_jabatan = row[8] || '';
                            data.alamat = row[9] || '';
                            data.nama_ayah = row[10] || '';
                            data.nama_ibu = row[11] || '';
                        } else if (importType === 'guru' || importType === 'tendik') {
                            data.nama = row[0] || '';
                            data.nik = row[1] || '';
                            data.nuptk = row[2] || '';
                            data.tempat_lahir = row[3] || '';
                            data.tanggal_lahir = row[4] || '';
                            data.alamat = row[5] || '';
                            data.no_telepon = row[6] || '';
                            data.email = row[7] || '';
                            data.kelas_jabatan = row[8] || '';
                        } else if (importType === 'kelas') {
                            data.nama = row[0] || '';
                            data.nip_nisn = row[1] || '';
                            data.kelas_jabatan = row[2] || '';
                        }

                        // Validate required fields
                        if (data.nama && data.nama.trim()) {
                            allData.push(data);
                            successCount++;
                        } else {
                            errorCount++;
                        }
                    } catch (error) {
                        errorCount++;
                    }
                });

                // Update counts
                currentRecordCount = allData.length;
                
                // Save to localStorage
                saveDataToLocalStorage();
                
                // Update UI
                updateStats();
                renderTable(importType);
                
                // Sync to Google Sheets if requested and connected
                if (syncToSheets && isGoogleSheetsConnected) {
                    await syncWithGoogleSheets();
                }
                
                hideImportModal();
                showNotification(`Import selesai! ${successCount} data berhasil diimport, ${errorCount} data gagal.`, 'success');

            } catch (error) {
                console.error('Import error:', error);
                showNotification('Terjadi kesalahan saat import: ' + error.message, 'error');
            } finally {
                importBtn.disabled = false;
                importText.textContent = 'Import Data';
                spinner.classList.add('hidden');
            }
        }

        // Settings Functions
        function updateSettingsForm() {
            document.getElementById('setting-nama-sekolah').value = schoolConfig.nama_sekolah;
            document.getElementById('setting-alamat-sekolah').value = schoolConfig.alamat_sekolah;
            document.getElementById('setting-kepala-sekolah').value = schoolConfig.kepala_sekolah;
            
            // Set connection method
            const scriptRadio = document.querySelector('input[name="connection-method"][value="script"]');
            const apiRadio = document.querySelector('input[name="connection-method"][value="api"]');
            
            if (googleSheetsConfig.useScript) {
                scriptRadio.checked = true;
            } else {
                apiRadio.checked = true;
            }
            
            // Update form visibility
            toggleConnectionMethod();
            
            // Fill API fields if using API method
            if (!googleSheetsConfig.useScript) {
                document.getElementById('setting-google-api-key').value = googleSheetsConfig.apiKey || '';
                document.getElementById('setting-google-sheet-id').value = googleSheetsConfig.sheetId || '';
            }
        }

        function updateSchoolInfoForm(event) {
            event.preventDefault();
            
            const updateBtn = document.getElementById('update-school-btn');
            const updateText = updateBtn.querySelector('.update-text');
            const spinner = updateBtn.querySelector('.loading-spinner');
            
            updateBtn.disabled = true;
            updateText.textContent = 'Menyimpan...';
            spinner.classList.remove('hidden');

            setTimeout(() => {
                schoolConfig.nama_sekolah = document.getElementById('setting-nama-sekolah').value;
                schoolConfig.alamat_sekolah = document.getElementById('setting-alamat-sekolah').value;
                schoolConfig.kepala_sekolah = document.getElementById('setting-kepala-sekolah').value;

                saveConfig();
                updateSchoolInfo();
                
                showNotification('Informasi sekolah berhasil diperbarui!', 'success');

                updateBtn.disabled = false;
                updateText.textContent = 'Simpan Perubahan';
                spinner.classList.add('hidden');
            }, 500);
        }

        function showResetConfirmation() {
            document.getElementById('reset-modal').classList.remove('hidden');
        }

        function hideResetModal() {
            document.getElementById('reset-modal').classList.add('hidden');
        }

        function confirmReset() {
            // Reset to default values
            schoolConfig = {
                nama_sekolah: "SDN Merdeka 01",
                alamat_sekolah: "Jl. Pendidikan No. 123, Jakarta",
                kepala_sekolah: "Drs. Ahmad Wijaya, M.Pd"
            };
            
            googleSheetsConfig = {
                apiKey: '',
                sheetId: '',
                isConfigured: false
            };

            saveConfig();
            updateSchoolInfo();
            updateSettingsForm();
            initializeGoogleSheets();
            
            hideResetModal();
            showNotification('Pengaturan berhasil direset ke nilai default!', 'success');
        }

        // Login Functions
        function handleLogin(event) {
            event.preventDefault();
            
            const loginBtn = document.getElementById('login-btn');
            const loginText = loginBtn.querySelector('.login-text');
            const spinner = loginBtn.querySelector('.loading-spinner');
            const errorDiv = document.getElementById('login-error');
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            loginBtn.disabled = true;
            loginText.textContent = 'Memverifikasi...';
            spinner.classList.remove('hidden');
            errorDiv.classList.add('hidden');

            // Simulate login process
            setTimeout(() => {
                if (username === 'admin' && password === 'admin123') {
                    document.getElementById('login-page').classList.add('hidden');
                    document.getElementById('main-app').classList.remove('hidden');
                    showNotification('Login berhasil! Selamat datang di Sistem Dapodik.', 'success');
                } else {
                    errorDiv.classList.remove('hidden');
                    loginBtn.disabled = false;
                    loginText.textContent = 'Masuk';
                    spinner.classList.add('hidden');
                }
            }, 1000);
        }

        function handleLogout() {
            document.getElementById('main-app').classList.add('hidden');
            document.getElementById('login-page').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            showNotification('Anda telah logout dari sistem.', 'success');
        }

        // Notification System
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-md shadow-lg max-w-sm transition-all duration-300 transform translate-x-full`;
            
            const bgColor = {
                'success': 'bg-green-50 border border-green-200',
                'error': 'bg-red-50 border border-red-200',
                'warning': 'bg-yellow-50 border border-yellow-200',
                'info': 'bg-blue-50 border border-blue-200'
            };
            
            const textColor = {
                'success': 'text-green-800',
                'error': 'text-red-800',
                'warning': 'text-yellow-800',
                'info': 'text-blue-800'
            };
            
            const icon = {
                'success': '✅',
                'error': '❌',
                'warning': '⚠️',
                'info': 'ℹ️'
            };
            
            notification.className += ` ${bgColor[type]}`;
            notification.innerHTML = `
                <div class="flex items-start">
                    <span class="mr-2">${icon[type]}</span>
                    <div class="flex-1">
                        <p class="text-sm font-medium ${textColor[type]}">${message}</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-gray-400 hover:text-gray-600">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 300);
            }, 5000);
        }

        // Real-time Sync Functions
        let syncInterval;

        function startRealTimeSync() {
            if (syncInterval) {
                clearInterval(syncInterval);
            }

            // Sync every 30 seconds if connected
            syncInterval = setInterval(async () => {
                if (isGoogleSheetsConnected && sheetsAPI) {
                    try {
                        await loadDataFromGoogleSheets();
                    } catch (error) {
                        console.log('Background sync failed:', error);
                    }
                }
            }, 30000);
        }

        function stopRealTimeSync() {
            if (syncInterval) {
                clearInterval(syncInterval);
                syncInterval = null;
            }
        }

        // Cross-tab sync
        function handleStorageChange(event) {
            if (event.key === 'dapodik_data') {
                // Data changed in another tab, reload
                loadDataFromLocalStorage();
                showNotification('Data diperbarui dari tab lain', 'info');
            }
        }

        // Visibility change handler for tab focus
        function handleVisibilityChange() {
            if (!document.hidden && isGoogleSheetsConnected) {
                // Tab became active, sync data
                loadDataFromGoogleSheets();
            }
        }

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            startRealTimeSync();
            
            // Add event listeners for cross-tab sync
            window.addEventListener('storage', handleStorageChange);
            document.addEventListener('visibilitychange', handleVisibilityChange);
            
            // Cleanup on page unload
            window.addEventListener('beforeunload', function() {
                stopRealTimeSync();
            });
        });

        // Drag and drop for file upload
        const uploadArea = document.getElementById('upload-area');
        if (uploadArea) {
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('border-blue-500', 'bg-blue-50');
            });

            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('border-blue-500', 'bg-blue-50');
            });

            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('border-blue-500', 'bg-blue-50');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    document.getElementById('import-file').files = files;
                    handleFileSelect({ target: { files: files } });
                }
            });
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99379143120db5d0',t:'MTc2MTI4ODkxNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
